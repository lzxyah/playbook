- hosts: node
  remote_user: root
  tasks:
  - name: ssh
    shell: echo "StrictHostKeyChecking no" >> /etc/ssh/ssh_config  
  - name: sshd
    shell: "{{ item }}"
    with_items:
     - sed '/GSSAPIAuthentication/d' -i  /etc/ssh/sshd_config
     - sed '/UseDNS/d'  -i  /etc/ssh/sshd_config
     - echo "GSSAPIAuthentication no" >> /etc/ssh/sshd_config
     - echo "UseDNS no " >> /etc/ssh/sshd_config 
  - name: restart sshd
    service:
     name: "{{ item }}"
     state: restarted 
    with_items:
     - sshd
  - name: install packages
    yum:
     name: "{{ item }}"
     state: present
    with_items:
     - 'unzip'
     - 'gcc'
     - 'gcc-c++'
     - 'ksh'
     - 'compat-libcap1'
     - 'compat-libstdc++-33'
     - 'libaio-devel'
    tags:
      - rpm
  - name: create
    file:
     path: "{{ item }}"
     state: directory
     mode: 0755
    with_items:
     - /u01
  - name: group
    group:
     name: "{{ item }}"
     state: present
    with_items:
     - oinstall
     - dba
     - oper
  - name: user
    user:
     name: "{{ item }}"
     group: oinstall
     groups: oinstall,dba,oper
     uid: 1000
     state: present
    with_items:
     - oracle
  - name: change name
    raw: "echo {{hostname|quote}} > /etc/hostname"
  - name:
    shell: hostname {{hostname|quote}}
  - name: hostname
    shell: hostname 
    tags:
     - hostname
  - name: desktop1  yum groupinstall "GNOME Desktop" "Graphical Administration Tools" -y
    yum:
      name: "{{ item }}"
    with_items:
      - '@^gnome-desktop-environment'
      - '@Graphical Administration Tools'
    tags:
      - desktop1
    ignore_errors: True
  - name: desktop2
    shell: ln -sf /lib/systemd/system/runlevel5.target /etc/systemd/system/default.target
    tags:
      - desktop2
  - name: copy
    copy:
       src: /opt/12c
       dest: /u01/
       mode: 0777
    tags:
     - copy
  - name: mkdir
    file:
      path: /u01/soft
      state: directory
      mode: 0755
      owner: oracle
      group: oinstall
    tags:
     - unzip 
  - name: unzip 
    unarchive: 
      src: "{{ item }}" 
      dest: /u01/soft
      remote_src: yes
      owner: oracle
      group: oinstall
      mode: 01777
    with_items:
       - /u01/12c/V46095-01_1of2.zip
       - /u01/12c/V46095-01_2of2.zip
       - /u01/12c/V840019-01.zip
    tags:
     - unzip 
  - name: dd 18g
    shell: dd if=/dev/zero of=/.swap bs=1024 count=18000000
    tags:
     - swap
  - name: chmod 0600
    shell: chmod 0600 /.swap 
    tags:
     - swap
  - name: mkswap
    shell: mkswap /.swap
    tags:
     - swap
  - name: swapon
    shell: swapon /.swap
    tags:
     - swap
  - name: fstab
    shell: echo "/.swap              swap                    swap    defaults        0 0" >> /etc/fstab
    tags:
     - swap
